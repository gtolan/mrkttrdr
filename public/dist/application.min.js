"use strict";var ApplicationConfiguration=function(){var applicationModuleName="mean",applicationModuleVendorDependencies=["ngResource","ngAnimate","ngMessages","ngMap","ngMaterial","angularPayments","ngTagsInput","ui.router","ui.bootstrap","ui.utils","angularFileUpload","angular-scroll-animate","counter","chart.js"],registerModule=function(moduleName,dependencies){angular.module(moduleName,dependencies||[]),angular.module(applicationModuleName).requires.push(moduleName)};return{applicationModuleName:applicationModuleName,applicationModuleVendorDependencies:applicationModuleVendorDependencies,registerModule:registerModule}}();angular.module(ApplicationConfiguration.applicationModuleName,ApplicationConfiguration.applicationModuleVendorDependencies),angular.module(ApplicationConfiguration.applicationModuleName).config(["$locationProvider","$httpProvider",function($locationProvider,$httpProvider){$locationProvider.html5Mode(!0).hashPrefix("!"),$httpProvider.interceptors.push("authInterceptor")}]),angular.module(ApplicationConfiguration.applicationModuleName).run(["$rootScope","$state","Authentication",function($rootScope,$state,Authentication){function storePreviousState(state,params){state.data&&state.data.ignoreState||($state.previous={state:state,params:params,href:$state.href(state,params)})}$rootScope.$on("$stateChangeStart",function(event,toState,toParams,fromState,fromParams){if(toState.data&&toState.data.roles&&toState.data.roles.length>0){var allowed=!1;toState.data.roles.forEach(function(role){return void 0!==Authentication.user.roles&&-1!==Authentication.user.roles.indexOf(role)?(allowed=!0,!0):void 0}),allowed||(event.preventDefault(),void 0!==Authentication.user&&"object"==typeof Authentication.user?$state.go("forbidden"):$state.go("authentication.signin").then(function(){storePreviousState(toState,toParams)}))}}),$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){storePreviousState(fromState,fromParams)})}]),angular.element(document).ready(function(){if(window.location.hash&&"#_=_"===window.location.hash)if(window.history&&history.pushState)window.history.pushState("",document.title,window.location.pathname);else{var scroll={top:document.body.scrollTop,left:document.body.scrollLeft};window.location.hash="",document.body.scrollTop=scroll.top,document.body.scrollLeft=scroll.left}angular.bootstrap(document,[ApplicationConfiguration.applicationModuleName])}),ApplicationConfiguration.registerModule("core"),ApplicationConfiguration.registerModule("core.admin",["core"]),ApplicationConfiguration.registerModule("core.admin.routes",["ui.router"]),function(app){app.registerModule("offers")}(ApplicationConfiguration),function(app){app.registerModule("tasks")}(ApplicationConfiguration),ApplicationConfiguration.registerModule("users",["core"]),ApplicationConfiguration.registerModule("users.admin",["core.admin"]),ApplicationConfiguration.registerModule("users.admin.routes",["core.admin.routes"]),angular.module("core.admin").run(["Menus",function(Menus){Menus.addMenuItem("topbar",{title:"Admin",state:"admin",type:"dropdown",roles:["admin"]})}]),angular.module("core.admin.routes").config(["$stateProvider",function($stateProvider){$stateProvider.state("admin",{"abstract":!0,url:"/admin",template:"<ui-view/>",data:{roles:["admin"]}})}]),angular.module("core").config(["$stateProvider","$urlRouterProvider",function($stateProvider,$urlRouterProvider){$urlRouterProvider.otherwise(function($injector,$location){$injector.get("$state").transitionTo("not-found",null,{location:!1})}),$stateProvider.state("home",{url:"/",templateUrl:"modules/core/client/views/home2.client.view.html"}).state("home2",{url:"/home2",templateUrl:"modules/core/client/views/home2.client.view.html"}).state("findOutMore",{url:"/find-out-more",templateUrl:"modules/core/client/views/TaskCategories.client.view.html"}).state("about",{url:"/about-us",templateUrl:"modules/core/client/views/aboutUs.client.view.html"}).state("contact",{url:"/contact-us",templateUrl:"modules/core/client/views/contactUs.client.view.html"}).state("newUser",{url:"/new-user-faq",templateUrl:"modules/core/client/views/newUserFaq.client.view.html"}).state("priceGuide",{url:"/price-guide",templateUrl:"modules/core/client/views/PriceGuide.client.view.html"}).state("marketplace",{url:"/marketplace-rules",templateUrl:"modules/core/client/views/MarketPlaceRules.client.view.html"}).state("howsWorking",{url:"/how-it-works",templateUrl:"modules/core/client/views/howsWorking.client.view.html"}).state("taskCategories",{url:"/task-categories",templateUrl:"modules/core/client/views/TaskCategories.client.view.html"}).state("earnWithUs",{url:"/earn-with-us",templateUrl:"modules/core/client/views/earn-about.client.view.html"}).state("investors",{url:"/investors",templateUrl:"modules/core/client/views/investors.client.view.html"}).state("post",{url:"/posting-a-task",templateUrl:"modules/core/client/views/posting.client.view.html"}).state("terms",{url:"/terms-conditions",templateUrl:"modules/core/client/views/Terms.client.view.html"}).state("privacy",{url:"/privacy-policy",templateUrl:"modules/core/client/views/Privacy.client.view.html"}).state("faqs",{url:"/faqs",templateUrl:"modules/core/client/views/LearnMore.client.view.html"}).state("support",{url:"/support",templateUrl:"modules/core/client/views/support.client.view.html"}).state("not-found",{url:"/not-found",templateUrl:"modules/core/client/views/404.client.view.html",data:{ignoreState:!0}}).state("bad-request",{url:"/bad-request",templateUrl:"modules/core/client/views/400.client.view.html",data:{ignoreState:!0}}).state("forbidden",{url:"/",onEnter:["$modal",function($modal){$modal.open({templateUrl:"myModalContent.html",controller:"ModalLoginCtrl",data:{ignoreState:!0}})}]})}]),angular.module("core").controller("AccordionValuesCtrl",["$scope",function($scope){$scope.status={isFirstOpen:!0,isFirstDisabled:!1}}]),angular.module("core").controller("FAQCollapseCtrl",["$scope",function($scope){$scope.PostingCollapsed=!0,$scope.completingCollapsed=!0}]),angular.module("core").controller("ContactFormController",["$scope","$mdToast","$animate","$document","$http",function($scope,$mdToast,$document,$animate,$http){$scope.toastPosition={bottom:!0,top:!1,left:!1,right:!0},$scope.getToastPosition=function(){return Object.keys($scope.toastPosition).filter(function(pos){return $scope.toastPosition[pos]}).join(" ")},this.sendMail=function(){var data={contactName:this.contactName,contactEmail:this.contactEmail,contactMessage:this.contactMessage};$http.post("/contact-form",data).success(function(data,status,headers,config){$mdToast.show($mdToast.simple().content("Thanks for your message "+data.contactName).position($scope.getToastPosition()).hideDelay(5e3))}).error(function(data,status,headers,config){})}}]),angular.module("core").controller("HeaderController",["$scope","$state","Authentication","Menus",function($scope,$state,Authentication,Menus){$scope.$state=$state,$scope.authentication=Authentication,$scope.menu=Menus.getMenu("topbar"),$scope.isCollapsed=!1,$scope.toggleCollapsibleMenu=function(){$scope.isCollapsed=!$scope.isCollapsed};$scope.$on("$stateChangeSuccess",function(){$scope.isCollapsed=!1})}]),angular.module("core").controller("HomeController",["$scope","Authentication","$location","$anchorScroll",function($scope,Authentication,$location,$anchorScroll){function DialogController($scope,$mdDialog){$scope.hide=function(){$mdDialog.hide()},$scope.cancel=function(){$mdDialog.cancel()},$scope.answer=function(answer){$mdDialog.hide(answer)},$scope.states="Mardid Barcelona Sevilla Malaga Valencia Bilbao Zaragoza MO MT NE NV NH NJ NM NY NC ND OH OK OR PA RI SC SD TN TX UT VT VA WA WV WI WY".split(" ").map(function(state){return{abbrev:state}})}DialogController.$inject=["$scope","$mdDialog"],$scope.authentication=Authentication,$scope.footerCollapsedRowOne=!0,$scope.footerCollapsedRowTwo=!0,$scope.footerCollapsedRowThree=!0,$scope.footerCollapsedRowFour=!0,$scope.source="../modules/core/client/img/BGdark.png",$scope.gotoTasks=function(){$location.hash("tasksAnchor"),$anchorScroll()},$scope.gotoTopPriceGuide=function(){$location.hash("TopPriceGuideAnchor"),$anchorScroll()},$scope.gotoHandy=function(){$location.hash("HandyAnchor"),$anchorScroll()},$scope.gotoDelivery=function(){$location.hash("DeliveryAnchor"),$anchorScroll()},$scope.gotoCleaning=function(){$location.hash("CleaningAnchor"),$anchorScroll()},$scope.gotoGardening=function(){$location.hash("GardeningAnchor"),$anchorScroll()},$scope.gotoDesign=function(){$location.hash("DesignAnchor"),$anchorScroll()},$scope.gotoOffice=function(){$location.hash("OfficeAnchor"),$anchorScroll()},$scope.gotoComputer=function(){$location.hash("ComputerAnchor"),$anchorScroll()},$scope.gotoResearch=function(){$location.hash("ResearchAnchor"),$anchorScroll()},$scope.gotoPromo=function(){$location.hash("PromoAnchor"),$anchorScroll()},$scope.gotoFurniture=function(){$location.hash("FurnitureAnchor"),$anchorScroll()},$scope.gotoWhatisTaskM=function(){$location.hash("WhatisTaskMAnchor"),$anchorScroll()},$scope.gotoWhatTaskCan=function(){$location.hash("WhatTaskCanAnchor"),$anchorScroll()},$scope.gotoHowCanComplete=function(){$location.hash("HowCanCompleteAnchor"),$anchorScroll()},$scope.gotoMuchCost=function(){$location.hash("MuchCostAnchor"),$anchorScroll()},$scope.gotoHaveToHire=function(){$location.hash("HaveToHireAnchor"),$anchorScroll()},$scope.gotoTrustQuality=function(){$location.hash("TrustQualityAnchor"),$anchorScroll()},$scope.gotoChoosePerson=function(){$location.hash("ChoosePersonAnchor"),$anchorScroll()},$scope.gotoKnowPay=function(){$location.hash("KnowPayAnchor"),$anchorScroll()},$scope.gotoDiscussTasks=function(){$location.hash("DiscussTasksAnchor"),$anchorScroll()},$scope.gotoPayOptions=function(){$location.hash("PayOptionsAnchor"),$anchorScroll()},$scope.gotoWorkAndEarn=function(){$location.hash("WorkAndEarnAnchor"),$anchorScroll()},$scope.gotoStartEarning=function(){$location.hash("StartEarningAnchor"),$anchorScroll()},$scope.gotoRecievePayment=function(){$location.hash("RecievePaymentAnchor"),$anchorScroll()},$scope.gotoNewFAQTop=function(){$location.hash("NewFAQTopAnchor"),$anchorScroll()},$scope.myInterval=1e4,$scope.noWrapSlides=!1;$scope.slides=[{url1:"link.list",image1:"../modules/core/client/img/carousel/antena.png",title1:"",description1:"",url2:"link.list",image2:"../modules/core/client/img/carousel/elmundo.jpg",title2:"",description2:"",url3:"link.list",image3:"../modules/core/client/img/carousel/elpais.png",title3:"",description3:"",url4:"link.list",image4:"../modules/core/client/img/carousel/telecinco.jpg",title4:"Marketplace",description4:""},{url1:"link.list",image1:"../modules/core/client/img/carousel/telemadrid.png",title1:"",description1:"",url2:"link.list",image2:"../modules/core/client/img/carousel/tv3.png",title2:"",description2:"",url3:"link.list",image3:"../modules/core/client/img/carousel/bbc.png",title3:"",description3:"",url4:"link.list",image4:"../modules/core/client/img/carousel/elmundo.jpg",title4:"",description4:""},{url1:"link.list",image1:"../modules/core/client/img/carousel/elpais.png",title1:"",description1:"",url2:"link.list",image2:"../modules/core/client/img/carousel/telemadrid.png",title2:"",description2:"",url3:"link.list",image3:"../modules/core/client/img/carousel/tv3.png",title3:"",description3:"",url4:"link.list",image4:"../modules/core/client/img/carousel/bbc.png",title4:"",description4:""}];$scope.status="  ",$scope.customFullscreen=!1,$scope.showTabDialog=function(ev){$mdDialog.show({controller:DialogController,templateUrl:"tabDialog.tmpl.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(answer){$scope.status='You said the information was "'+answer+'".'},function(){$scope.status="You cancelled the dialog."})},$scope.getScrollOffsets=function(w){if(w=w||window,null!==w.pageXOffset)return{x:w.pageXOffset,y:w.pageYOffset};var d=w.document;return"CSS1Compat"===document.compatMode?{x:d.documentElement.scrollLeft,y:d.documentElement.scrollTop}:{x:d.body.scrollLeft,y:d.body.scrollTop}},$scope.getPosition=function(e){return{x:e[0].offsetLeft,y:e[0].offsetTop}},$scope.getViewPortSize=function(w){return{x:Math.max(document.documentElement.clientWidth,w.innerWidth||0),y:Math.max(document.documentElement.clientHeight,w.innerHeight||0)}}}]).directive("aniScroll",["$window",function($window){return{restrict:"A",controller:"HomeController",transclude:!0,replace:!0,template:"<div ng-transclude ng-show='show'></div>",scope:{show:"@"},link:function(scope,element,attrs){angular.element($window).bind("scroll",function(){var targetOffset=attrs.aniScroll,offset=scope.getScrollOffsets($window);offset.y>=targetOffset?scope.show=!0:scope.show=!1,scope.$apply()})}}}]).directive("aniView",["$window",function($window){return{restrict:"A",controller:"HomeController",transclude:!0,replace:!0,template:"<div ng-transclude ng-show='show'></div>",scope:{show:"@"},link:function(scope,element,attrs){angular.element($window).bind("scroll",function(){var position=scope.getPosition(element),offset=scope.getScrollOffsets($window),viewport=scope.getViewPortSize($window),coverage={x:parseInt(viewport.x+offset.x),y:parseInt(viewport.y+offset.y)};coverage.y>=position.y&&coverage.x>=position.x?scope.show=!0:scope.show=!1,scope.$apply()})}}}]).directive("loadedImg",function(){return{restrict:"E",scope:{src:"="},replace:!0,template:'<img ng-src="{{src}}" class="none realBG animated fadeIn"/>',link:function(scope,ele,attr){ele.on("load",function(){ele.removeClass("none")})}}}).directive("countUp",["$compile",function($compile,$timeout){return{restrict:"E",replace:!1,scope:{countTo:"=countTo",interval:"=interval"},controller:["$scope","$element","$attrs","$timeout",function($scope,$element,$attrs,$timeout){function timeloop(){setTimeout(function(){$scope.millis++,$scope.$digest(),i++,i<$scope.countTo&&timeloop()},$scope.interval)}$scope.millis=0,0===$element.html().trim().length?$element.append($compile("<span>{{millis / 1000}}</span>")($scope)):$element.append($compile($element.contents())($scope));var i=0;timeloop()}]}}]),angular.module("core").controller("ModalLoginCtrl",["$scope","$state","Authentication","Menus","$modal","$log",function($scope,$state,Authentication,Menus,$modal,$log){$scope.items=["item1","item2","item3"],$scope.open=function(size){var modalInstance=$modal.open({templateUrl:"myModalContent.html",controller:"ModalInstanceCtrl",size:size,resolve:{items:function(){return $scope.items}}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}}]),angular.module("core").controller("ModalInstanceCtrl",["$scope","Authentication","$modalInstance","items",function($scope,Authentication,$modalInstance,items){$scope.items=items,$scope.selected={item:$scope.items[0]},$scope.authentication=Authentication,$scope.ok=function(){$modalInstance.close($scope.selected.item)},$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("core").directive("showErrors",["$timeout","$interpolate",function($timeout,$interpolate){var linkFn=function(scope,el,attrs,formCtrl){var inputEl,inputName,inputNgEl,options,showSuccess,toggleClasses,initCheck=!1,showValidationMessages=!1;if(options=scope.$eval(attrs.showErrors)||{},showSuccess=options.showSuccess||!1,inputEl=el[0].querySelector(".form-control[name]")||el[0].querySelector("[name]"),inputNgEl=angular.element(inputEl),inputName=$interpolate(inputNgEl.attr("name")||"")(scope),!inputName)throw"show-errors element has no child input elements with a 'name' attribute class";var reset=function(){return $timeout(function(){el.removeClass("has-error"),el.removeClass("has-success"),showValidationMessages=!1},0,!1)};scope.$watch(function(){return formCtrl[inputName]&&formCtrl[inputName].$invalid},function(invalid){return toggleClasses(invalid)}),scope.$on("show-errors-check-validity",function(event,name){return angular.isUndefined(name)||formCtrl.$name===name?(initCheck=!0,showValidationMessages=!0,toggleClasses(formCtrl[inputName].$invalid)):void 0}),scope.$on("show-errors-reset",function(event,name){return angular.isUndefined(name)||formCtrl.$name===name?reset():void 0}),toggleClasses=function(invalid){return el.toggleClass("has-error",showValidationMessages&&invalid),showSuccess?el.toggleClass("has-success",showValidationMessages&&!invalid):void 0}};return{restrict:"A",require:"^form",compile:function(elem,attrs){if(-1===attrs.showErrors.indexOf("skipFormGroupCheck")&&!elem.hasClass("form-group")&&!elem.hasClass("input-group"))throw"show-errors element does not have the 'form-group' or 'input-group' class";return linkFn}}}]),angular.module("core").factory("authInterceptor",["$q","$injector",function($q,$injector){return{responseError:function(rejection){if(!rejection.config.ignoreAuthModule)switch(rejection.status){case 401:$injector.get("$state").transitionTo("authentication.signin");break;case 403:$injector.get("$state").transitionTo("forbidden")}return $q.reject(rejection)}}}]),angular.module("core").service("Menus",[function(){this.defaultRoles=["user","admin"],this.menus={};var shouldRender=function(user){if(~this.roles.indexOf("*"))return!0;if(!user)return!1;for(var userRoleIndex in user.roles)for(var roleIndex in this.roles)if(this.roles[roleIndex]===user.roles[userRoleIndex])return!0;return!1};this.validateMenuExistance=function(menuId){if(menuId&&menuId.length){if(this.menus[menuId])return!0;throw new Error("Menu does not exist")}throw new Error("MenuId was not provided")},this.getMenu=function(menuId){return this.validateMenuExistance(menuId),this.menus[menuId]},this.addMenu=function(menuId,options){return options=options||{},this.menus[menuId]={roles:options.roles||this.defaultRoles,items:options.items||[],shouldRender:shouldRender},this.menus[menuId]},this.removeMenu=function(menuId){this.validateMenuExistance(menuId),delete this.menus[menuId]},this.addMenuItem=function(menuId,options){if(options=options||{},this.validateMenuExistance(menuId),this.menus[menuId].items.push({title:options.title||"",state:options.state||"",type:options.type||"item","class":options["class"],roles:null===options.roles||"undefined"==typeof options.roles?this.defaultRoles:options.roles,position:options.position||0,items:[],shouldRender:shouldRender}),options.items)for(var i in options.items)this.addSubMenuItem(menuId,options.state,options.items[i]);return this.menus[menuId]},this.addSubMenuItem=function(menuId,parentItemState,options){options=options||{},this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].state===parentItemState&&this.menus[menuId].items[itemIndex].items.push({title:options.title||"",state:options.state||"",roles:null===options.roles||"undefined"==typeof options.roles?this.menus[menuId].items[itemIndex].roles:options.roles,position:options.position||0,shouldRender:shouldRender});return this.menus[menuId]},this.removeMenuItem=function(menuId,menuItemState){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)this.menus[menuId].items[itemIndex].state===menuItemState&&this.menus[menuId].items.splice(itemIndex,1);return this.menus[menuId]},this.removeSubMenuItem=function(menuId,submenuItemState){this.validateMenuExistance(menuId);for(var itemIndex in this.menus[menuId].items)for(var subitemIndex in this.menus[menuId].items[itemIndex].items)this.menus[menuId].items[itemIndex].items[subitemIndex].state===submenuItemState&&this.menus[menuId].items[itemIndex].items.splice(subitemIndex,1);return this.menus[menuId]},this.addMenu("topbar",{roles:["*"]})}]),angular.module("core").service("Socket",["Authentication","$state","$timeout",function(Authentication,$state,$timeout){this.connect=function(){Authentication.user&&(this.socket=io())},this.connect(),this.on=function(eventName,callback){this.socket&&this.socket.on(eventName,function(data){$timeout(function(){callback(data)})})},this.emit=function(eventName,data){this.socket&&this.socket.emit(eventName,data)},this.removeListener=function(eventName){this.socket&&this.socket.removeListener(eventName)}}]),function(){function routeConfig($stateProvider){$stateProvider.state("offers",{"abstract":!0,url:"/offers",template:"<ui-view/>"}).state("offers.list",{url:"",templateUrl:"modules/offers/client/views/list-offers.client.view.html",controller:"OffersListController",controllerAs:"vm",data:{pageTitle:"Offers List"}}).state("offers.create",{url:"/create",templateUrl:"modules/offers/client/views/form-offer.client.view.html",controller:"OffersController",controllerAs:"vm",resolve:{offerResolve:newOffer},data:{roles:["user","admin"],pageTitle:"Offers Create"}}).state("offers.edit",{url:"/:offerId/edit",templateUrl:"modules/offers/client/views/form-offer.client.view.html",controller:"OffersController",controllerAs:"vm",resolve:{offerResolve:getOffer},data:{roles:["user","admin"],pageTitle:"Edit Offer {{ offerResolve.name }}"}}).state("offers.view",{url:"/:offerId",templateUrl:"modules/offers/client/views/view-offer.client.view.html",controller:"OffersController",controllerAs:"vm",resolve:{offerResolve:getOffer},data:{pageTitle:"Offer {{ articleResolve.name }}"}}).state("offers.accepted",{url:"/:offerId/accepted",templateUrl:"modules/offers/client/views/view-accepted-offer.client.view.html",controller:"OffersController",controllerAs:"vm",resolve:{offerResolve:getOffer},data:{pageTitle:"Offer {{ articleResolve.name }}"}}).state("offers.payment",{url:"/:offerId/accepted/payment",templateUrl:"modules/offers/client/views/accepted-offer-payment.client.view.html",controller:"PaymentsController",controllerAs:"vm",resolve:{offerResolve:getOffer},data:{pageTitle:"Offer {{ articleResolve.name }}"}}).state("offers.review",{url:"/:offerId/review",templateUrl:"modules/offers/client/views/leave-review-offer.client.view.html",controller:"OffersController",controllerAs:"vm",resolve:{offerResolve:getOffer}})}function getOffer($stateParams,OffersService){return OffersService.get({offerId:$stateParams.offerId}).$promise}function newOffer(OffersService){return new OffersService}angular.module("offers").config(routeConfig),routeConfig.$inject=["$stateProvider"],getOffer.$inject=["$stateParams","OffersService"],newOffer.$inject=["OffersService"]}(),function(){function OffersListController(OffersService){var vm=this;vm.offers=OffersService.query()}angular.module("offers").controller("OffersListController",OffersListController),OffersListController.$inject=["OffersService"]}(),function(){function OffersController($scope,$state,$http,Authentication,offer,$modal,$mdToast,$animate){function remove(){confirm("Are you sure you want to delete?")&&vm.offer.$remove($state.go("offers.list"))}function save(isValid){function successCallback(res){$state.go("offers.view",{offerId:res._id})}function errorCallback(res){vm.error=res.data.message}return isValid?void(vm.offer._id?vm.offer.$update(successCallback,errorCallback):vm.offer.$save(successCallback,errorCallback)):($scope.$broadcast("show-errors-check-validity","vm.form.offerForm"),!1)}var vm=this;vm.authentication=Authentication,vm.offer=offer,vm.error=null,vm.form={},vm.remove=remove,vm.save=save,$scope.totalAmount=vm.offer.offerPrice,$scope.isReadonly=!0,$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)};var numberOfReviews=vm.offer.offerUserAverage.length;$scope.numberOfReviews=numberOfReviews;for(var total=0,one=0,two=0,three=0,four=0,five=0,offerUserAverage=vm.offer.offerUserAverage,i=0;i<offerUserAverage.length;i++)1===offerUserAverage[i].rating?one+=1:2===offerUserAverage[i].rating?two+=1:3===offerUserAverage[i].rating?three+=1:4===offerUserAverage[i].rating?four+=1:5===offerUserAverage[i].rating&&(five+=1),total+=+offerUserAverage[i].rating;var userAverage=total/numberOfReviews;$scope.userAverage=userAverage,$scope.toastPosition={bottom:!1,top:!0,left:!1,right:!0},$scope.getToastPosition=function(){return Object.keys($scope.toastPosition).filter(function(pos){return $scope.toastPosition[pos]}).join(" ")},$scope.checkout=function(){$modal.open({templateUrl:"modules/offers/client/views/checkout.client.view.html",controller:"CheckoutCtrl",resolve:{totalAmount:$scope.totalAmount,offer:offer}})},vm.newCo=function(){function successCallback(res){vm.commentAlert(),$state.transitionTo($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})}function errorCallback(res){vm.error=res.data.message}vm.commentAlert=function(){if(vm.authentication.user._id===vm.offer.taskOwnerUser){var dataTaskOwner={contactName:vm.authentication.user.displayName,emailFrom:"contact@taskmatch.ie",emailTo:vm.offer.offerOwnerEmail,messageTo:vm.offer.user.displayName,offerTitle:vm.offer.offerDesc,taskName:vm.offer.taskName,offerId:vm.offer._id,commentOwner:vm.authentication.user.displayName,comment:vm.offer.newComment};$http.post("/api/offers/"+offer._id+"/comment-alert",dataTaskOwner).success(function(data,status,headers,config){console.log("comment alert email has been sent"),$mdToast.show($mdToast.simple().content("Thanks, "+data.contactName+"! You successfully posted a comment").position($scope.getToastPosition()).hideDelay(5e3))})}else if(vm.authentication.user._id===vm.offer.user._id){var dataOfferOwner={contactName:vm.authentication.user.displayName,emailFrom:"contact@taskmatch.ie",emailTo:vm.offer.taskOwnerEmail,messageTo:vm.offer.taskOwnerDisplayName,offerTitle:vm.offer.offerDesc,taskName:vm.offer.taskName,offerId:vm.offer._id,commentOwner:vm.authentication.user.displayName,comment:vm.offer.newComment};$http.post("/api/offers/"+offer._id+"/comment-alert",dataOfferOwner).success(function(data,status,headers,config){console.log("comment alert email has been sent"),$mdToast.show($mdToast.simple().content("Thanks, "+data.contactName+"! You successfully posted a comment").position($scope.getToastPosition()).hideDelay(5e3))})}},$http.post("/api/offers/"+offer._id+"/new-comment",{comment:{comment:vm.offer.newComment,user:vm.authentication.user,profileImageURL:vm.authentication.user.profileImageURL,displayName:vm.authentication.user.displayName}}).then(successCallback,errorCallback)},vm.assignTaskToThisUser=function(){function successCallback(res){vm.offerAccepted(),vm.taskAssigned()}function errorCallback(res){vm.error=res.data.message}vm.taskAssigned=function(){function successCallback(res){}function errorCallback(res){vm.error=res.data.message}$http.put("/api/tasks/"+offer.taskId+"/status",{statusAssigned:!0}).then(successCallback,errorCallback),swal("Success!","You successfully accepted this offer!","success")},vm.offerAccepted=function(){var data={contactName:vm.offer.displayName,emailFrom:"contact@taskmatch.ie",emailTo:vm.offer.offerOwnerEmail,offerOwner:vm.offer.displayName,offerDesc:vm.offer.offerDesc,offerId:vm.offer._id,taskName:vm.offer.taskName,taskId:vm.offer.taskId,taskOwner:vm.authentication.user.displayName,subject:"Your offer has been accepted on "+vm.offer.taskName+" - Get started ASAP!"};$http.post("/api/offers/"+offer._id+"/offer-accepted",data).success(function(data,status,headers,config){$state.transitionTo($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})})},$http.post("/api/offers/"+offer._id,{offerAccepted:!0}).then(successCallback,errorCallback),console.log("You successfully accepted this offer!")},vm.markTaskCompleted=function(){function successCallback(res){vm.leaveAReviewAlert(),$state.go("offers.review",{offerId:offer._id})}function errorCallback(res){vm.error=res.data.message}vm.leaveAReviewAlert=function(){var data={subject:vm.offer.taskOwnerDisplayName+" marked your offer as completed! Leave them a review now!",contactName:vm.offer.displayName,taskOwner:vm.offer.taskOwnerDisplayName,offerId:vm.offer._id,taskId:vm.offer.taskId,offerDesc:vm.offer.offerDesc,taskName:vm.offer.taskName,emailFrom:"contact@taskmatch.ie",emailTo:vm.offer.offerOwnerEmail};$http.post("/api/offers/"+offer._id+"/leave-a-new-review-alert",data).success(function(data,status,headers,config){console.log("sent")})},$http.post("/api/tasks/"+offer.taskId+"/status",{statusClosed:!0}).then(successCallback,errorCallback),swal("Success!","You successfully completed this task!","success")},vm.newTaskReview=function(){function successCallback(res){vm.reviewAlert(),swal("Success!","You successfully left a review!","success"),$state.go("profile",{userId:vm.offer.user._id})}function errorCallback(res){vm.error=res.data.message,alert("your request did not work!"+res.data.message)}vm.reviewAlert=function(){var data={contactName:vm.authentication.user.displayName,emailFrom:"contact@taskmatch.ie",emailTo:vm.offer.offerOwnerEmail,contactMessage:"Hi, "+vm.offer.user.displayName+"! \n "+vm.authentication.user.displayName+' has left the following review: " '+vm.review.comment+'" for your task "'+vm.offer.taskName+'" Login to Taskmatch.ie to view the review on your public profile. \n -- Thanks! from the Taskmatch.ie team'};$http.post("/api/offers/"+offer._id+"/review-alert",data).success(function(data,status,headers,config){console.log("sent"),$mdToast.show($mdToast.simple().content("Thanks for your review "+data.contactName).position($scope.getToastPosition()).hideDelay(5e3))})};var reviewUser=vm.offer.user._id;$http.post("/api/users/"+reviewUser,{review:{rating:vm.review.rating,comment:vm.review.comment,reviewFor:vm.offer.user._id,reviewBy:vm.authentication.user,displayName:vm.authentication.user.displayName,profileImageURL:vm.authentication.user.profileImageURL,taskId:vm.offer.taskId,taskName:vm.offer.taskName,offerId:vm.offer._id}}).then(successCallback,errorCallback)},vm.newOfferTaskReview=function(){function successCallback(res){vm.taskOwnerReviewAlert(),vm.markTaskOwnerReviewCompleted(),swal("Success!","You successfully left a review!","success"),$state.go("profile",{userId:vm.offer.taskOwnerUser})}function errorCallback(res){vm.error=res.data.message,alert("your request did not work!"+res.data.message)}vm.markTaskOwnerReviewCompleted=function(){function successCallback(res){console.log("You successfully completed the review for this offer!")}function errorCallback(res){vm.error=res.data.message,console.log(vm.error)}$http.post("/api/offers/"+offer._id+"/taskowner-review-completed",{taskOwnerReviewed:!0}).then(successCallback,errorCallback)},vm.taskOwnerReviewAlert=function(){var data={contactName:vm.offer.taskOwnerDisplayName,emailFrom:"contact@taskmatch.ie",emailTo:vm.offer.taskOwnerEmail,contactMessage:"Hi, "+vm.offer.taskOwnerDisplayName+"! \n "+vm.offer.user.displayName+' has left the following review: " '+vm.review.comment+'" for your task "'+vm.offer.taskName+'" Login to Taskmatch.ie to view the review on your public profile. \n -- Thanks! from the Taskmatch.ie team'};$http.post("/api/offers/"+offer._id+"/taskOwner-review-alert",data).success(function(data,status,headers,config){console.log("sent"),$mdToast.show($mdToast.simple().content("Thanks for your review "+data.contactName).position($scope.getToastPosition()).hideDelay(5e3))})};var reviewUser=vm.offer.taskOwnerUser;$http.post("/api/users/"+reviewUser,{review:{rating:vm.review.rating,comment:vm.review.comment,reviewFor:vm.offer.taskOwnerUser,reviewBy:vm.authentication.user,displayName:vm.authentication.user.displayName,profileImageURL:vm.authentication.user.profileImageURL,taskId:vm.offer.taskId,taskName:vm.offer.taskName,offerId:vm.offer._id}}).then(successCallback,errorCallback)}}angular.module("offers").controller("OffersController",OffersController),OffersController.$inject=["$scope","$state","$http","Authentication","offerResolve","$modal","$mdToast","$animate"]}(),function(){function PaymentsController(offer,$scope,$state,Authentication,$http,$mdToast,$document,$animate,$location,$rootScope,$modal,$window){$window.Stripe.setPublishableKey("pk_live_nycjXdZVMuyCeshiayQ32Ljb");var vm=this;vm.authentication=Authentication,vm.offer=offer,
$scope.amount=vm.offer.offerPrice+vm.offer.offerExpenses,$scope.owner=vm.offer.user._id,$scope.ownerName=vm.offer.user.displayName}angular.module("offers").controller("PaymentsController",PaymentsController).config(["$mdThemingProvider",function($mdThemingProvider){$mdThemingProvider.theme("default").primaryPalette("blue-grey")}]),PaymentsController.$inject=["offerResolve","$scope","$state","Authentication","$http","$mdToast","$document","$animate","$location","$rootScope","$modal","$window"]}(),function(){function CheckoutCtrl(Authentication,$scope,totalAmount,offer,$mdToast,$document,$animate,$http,$state){var vm=this;vm.offer=offer,$scope.user=Authentication.user,$scope.totalAmount=totalAmount,$scope.toastPosition={bottom:!1,top:!0,left:!1,right:!0},$scope.getToastPosition=function(){return Object.keys($scope.toastPosition).filter(function(pos){return $scope.toastPosition[pos]}).join(" ")},$scope.processing=!1,$scope.cancel=function(){$scope.$dismiss()},$scope.newCharge=function(){$scope.processing=!0;var data={contactName:this.contactName,customerId:$scope.user.stripeCustomerId,totalAmount:$scope.totalAmount};$http.post("/api/offers/"+offer._id+"/new-charge",data).success(function(res,charge,data,status,headers,config){$scope.processing=!1,$scope.success=!0,$scope.taskPaid(),$scope.paymentSuccess(),swal("Congratulations!","You successfully paid to have your task completed! \n You can now contact the offer user to arrange task details. \n Remember to mark the task as completed to release TaskMatch funds","success"),$scope.cancel(),$scope.taskPaid(),$scope.offerPaid(),$state.go("offers.accepted",{offerId:offer._id})}).error(function(res,charge,data,status,headers,config){sweetAlert("Oops...","Something went wrong!","error")})},$scope.taskPaid=function(){function successCallback(res){}function errorCallback(res){vm.error=res.data.message}$http.post("/api/tasks/"+vm.offer.taskId+"/status-paid",{statusPaid:!0}).then(successCallback,errorCallback),console.log("paid")},$scope.offerPaid=function(){function successCallback(res){}function errorCallback(res){vm.error=res.data.message}$http.put("/api/offers/"+vm.offer._id+"/status-paid",{statusPaid:!0}).then(successCallback,errorCallback),console.log("marked the offer as status paid")},$scope.paymentSuccess=function(){var data={emailFrom:"contact@taskmatch.ie",emailTo:vm.offer.taskOwnerEmail,offerOwner:vm.offer.displayName,offerDesc:vm.offer.offerDesc,offerId:vm.offer._id,taskName:vm.offer.taskName,taskId:vm.offer.taskId,subject:"You successfully paid for "+vm.offer.offerDesc+" on your task "+vm.offer.taskName};$http.post("/payment-success",data).success(function(data,status,headers,config){$mdToast.show($mdToast.simple().content("Thanks for your payment "+data.taskOwner).position($scope.getToastPosition()).hideDelay(5e3))}).error(function(data,status,headers,config){})},$scope.hideAlerts=function(){$scope.stripeError=null,$scope.stripeToken=null}}angular.module("offers").controller("CheckoutCtrl",CheckoutCtrl).config(["$mdThemingProvider",function($mdThemingProvider){$mdThemingProvider.theme("default").primaryPalette("blue-grey")}]),CheckoutCtrl.$inject=["Authentication","$scope","totalAmount","offer","$mdToast","$document","$animate","$http","$state"]}(),function(){function OffersService($resource){return $resource("api/offers/:offerId",{offerId:"@_id"},{update:{method:"PUT"}})}angular.module("offers").factory("OffersService",OffersService),OffersService.$inject=["$resource"]}(),function(){function menuConfig(Menus){Menus.addMenuItem("topbar",{title:"TAREAS",state:"tasks",type:"dropdown",roles:["*"]}),Menus.addSubMenuItem("topbar","tasks",{title:"Buscar Tareas",state:"tasks.list"}),Menus.addSubMenuItem("topbar","tasks",{title:"Encargar Tarea",state:"tasks.create",roles:["user"]})}angular.module("tasks").run(menuConfig),menuConfig.$inject=["Menus"]}(),function(){function routeConfig($stateProvider){$stateProvider.state("tasks",{"abstract":!0,url:"/tasks",template:"<ui-view/>"}).state("tasks.list",{url:"",templateUrl:"modules/tasks/client/views/list-tasks.client.view.html",controller:"TasksListController",controllerAs:"vm",data:{pageTitle:"Browse Tasks"},params:{myFilter:{statusOpen:!0}}}).state("tasks.create",{url:"/create",templateUrl:"modules/tasks/client/views/form-task.client.view.html",controller:"TasksController",controllerAs:"vm",resolve:{taskResolve:newTask},data:{roles:["user","admin"],pageTitle:"Tasks Create"}}).state("tasks.edit",{url:"/:taskId/edit",templateUrl:"modules/tasks/client/views/form-task.client.view.html",controller:"TasksController",controllerAs:"vm",resolve:{taskResolve:getTask},data:{roles:["user","admin"],pageTitle:"Edit Task {{ taskResolve.name }}"}}).state("tasks.view",{url:"/:taskId",templateUrl:"modules/tasks/client/views/view-task.client.view.html",parent:"tasks.list",controller:"TasksController",controllerAs:"vm",resolve:{taskResolve:getTask},data:{pageTitle:"Task {{ articleResolve.name }}"}})}function getTask($stateParams,TasksService){return TasksService.get({taskId:$stateParams.taskId}).$promise}function newTask(TasksService){return new TasksService}function newOffer(OffersService){return new OffersService}angular.module("tasks").config(routeConfig),routeConfig.$inject=["$stateProvider"],getTask.$inject=["$stateParams","TasksService"],newTask.$inject=["TasksService"],newOffer.$inject=["OffersService"]}(),function(){function ModalOfferCtrl($scope,$state,Authentication,Menus,$modal,$log,OffersService){function newOffer(OffersService){return new OffersService}function getTask($stateParams,TasksService){return TasksService.get({taskId:$stateParams.taskId}).$promise}$scope.authentication=Authentication,newOffer.$inject=["OffersService"],getTask.$inject=["$stateParams","TasksService"],$scope.cancel=function(){$scope.$dismiss()},$scope.open=function(size){var modalInstance=$modal.open({templateUrl:"myOfferModalContent.html",controller:"TasksController",size:size,controllerAs:"vm",resolve:{taskResolve:getTask,offerResolve:newOffer}});modalInstance.result.then(function(selectedItem){$scope.selected=selectedItem},function(){$log.info("Modal dismissed at: "+new Date)})}}angular.module("tasks").controller("ModalOfferCtrl",ModalOfferCtrl),ModalOfferCtrl.$inject=["$scope","$state","Authentication","Menus","$modal","$log","OffersService"]}(),function(){angular.module("tasks").controller("ModalOfferInstanceCtrl",["$scope","$modalInstance","$stateParams","TasksService","$http",function($scope,$modalInstance,$stateParams,TasksService,$http){$scope.ok=function(){$modalInstance.close($scope.selected.item)}}])}(),function(){function TasksListController(TasksService,OffersService,$scope,$stateParams,$filter,$http){var vm=this;$scope.taskCategories=[{cat:"All",filter:""},{cat:"Cleaning",filter:"cleaning: true"},{cat:"Moving & Delivery",filter:"moving: true"},{cat:"DIY",filter:"DIY: true"},{cat:"Marketing & Design",filter:"marketing: true"},{cat:"Digital & IT",filter:"onlineIT: true"},{cat:"Events & Photography",filter:"photoEvents: true"},{cat:"Business & Admin",filter:"office: true"},{cat:"Fun & Quirky",filter:"funQuirky: true"},{cat:"Misc & Other ",filter:"misc: true"}],vm.tasks=TasksService.query();$http.get("api/offers",{}).success(function(data,status){}),$scope.myFilter=$stateParams.myFilter;$filter("orderBy");$scope.predicate="created",$scope.reverse=!0,$scope.order=function(predicate){$scope.reverse=$scope.predicate===predicate?!$scope.reverse:!1,$scope.predicate=predicate}}angular.module("tasks").controller("TasksListController",TasksListController).filter("customFilter",function(){return function(items,search){return search?items.filter(function(element){return Object.getOwnPropertyNames(element).find(function(x){return x===search.substring(0,search.indexOf(":"))})}):items}}).filter("priceFilter",function(){return function(items,search){return search?items.filter(function(element){return Object.getOwnPropertyNames(element).find(function(x){return x===search.substring(0,1)})}):items}}),TasksListController.$inject=["TasksService","OffersService","$scope","$stateParams","$filter","$http"]}(),function(){function ModalTaskCtrl($scope,$state,Authentication,$modal,$log,$http,TasksService){function newTask(TasksService){return new TasksService}newTask.$inject=["TasksService"],$scope.authentication=Authentication,$scope.minDate=new Date,$scope.format="dd/MM/yyyy",$scope.altInputFormats=["d!/M!/yyyy"],$scope.dateOptions={formatYear:"yy",startingDay:1};var app=this;app.closeAlert=function(){app.reason=null},app.open=function(size){var modalInstance=$modal.open({templateUrl:"/modules/tasks/client/views/createTaskModal.client.view.html",controller:"TasksController",controllerAs:"vm",resolve:{taskResolve:newTask},size:size});modalInstance.result.then(function(data){app.closeAlert(),app.summary=data},function(reason){app.reason=reason})}}angular.module("tasks").directive("enterDirective",function(){return{link:function(scope,element,attrs){$(element).keypress(function(e){13==e.keyCode&&console.log("Enter pressed "+element.val())})}}}).config(["$mdDateLocaleProvider",function($mdDateLocaleProvider){$mdDateLocaleProvider.formatDate=function(date){return moment(date).format("DD/MM/YYYY")},$mdDateLocaleProvider.parseDate=function(dateString){var m=moment(dateString,"DD/MM/YYYY",!0);return m.isValid()?m.toDate():new Date(NaN)}}]).controller("ModalTaskCtrl",ModalTaskCtrl),ModalTaskCtrl.$inject=["$scope","$state","Authentication","$modal","$log","$http","TasksService"]}(),function(){function NgMapController(TasksService,$scope,$state,Authentication,$http,Users,$compile,NgMap){$scope.locationCollapsed=!0;var vm=this;$scope.addressMapCenter="Madrid, Spain",vm.tasks=TasksService.query(),NgMap.getMap().then(function(map){$scope.map=map,$scope.tasks=[]}),$scope.showCity=function(event,task){$scope.selectedTask=task,$scope.map.showInfoWindow("myInfoWindow",this)}}angular.module("tasks").controller("NgMapController",NgMapController),NgMapController.$inject=["TasksService","$scope","$state","Authentication","$http","Users","$compile","NgMap"]}(),function(){function ModalTaskCtrl($scope,$state,Authentication,TasksService,$modal,$log,$http){function newTask(TasksService){return new TasksService}newTask.$inject=["TasksService"],$scope.status={isopen:!1},$scope.toggled=function(open){$log.log("Dropdown is now: ",open)},$scope.toggleDropdown=function($event){$event.preventDefault(),$event.stopPropagation(),$scope.status.isopen=!$scope.status.isopen},$scope.cancel=function(){$scope.$dismiss()},$scope.myDate=new Date,$scope.minDate=new Date($scope.myDate.getFullYear(),$scope.myDate.getMonth()-2,$scope.myDate.getDate()),$scope.maxDate=new Date($scope.myDate.getFullYear(),$scope.myDate.getMonth()+2,$scope.myDate.getDate());var app=this;app.closeAlert=function(){app.reason=null},app.open=function(size){var modalInstance=$modal.open({templateUrl:"../modules/tasks/client/views/createTaskModal.client.view.html",controller:"TasksController",controllerAs:"vm",resolve:{taskResolve:newTask},size:size});modalInstance.result.then(function(data){app.closeAlert(),app.summary=data},function(reason){app.reason=reason})}}moment.locale("es"),angular.module("tasks").config(["$mdDateLocaleProvider",function($mdDateLocaleProvider){$mdDateLocaleProvider.formatDate=function(date){return moment(date).format("DD/MM/YYYY")},$mdDateLocaleProvider.parseDate=function(dateString){var m=moment(dateString,"DD/MM/YYYY",!0);return m.isValid()?m.toDate():new Date(NaN)}}]).controller("ModalTaskCtrl",ModalTaskCtrl),ModalTaskCtrl.$inject=["$scope","$state","Authentication","TasksService","$modal","$log","$http"]}(),function(){function TasksController($scope,$state,Authentication,task,$http,$modal,$mdToast,$animate){function remove(){swal({title:"Are you sure?",text:"You will not be able to recover this task!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel please!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){isConfirm?(swal("Deleted!","La tarea ha sido borrada","success"),vm.task.$remove().then(function(){$state.go("tasks.list",{},{reload:!0})})):swal("Cancelled","Your task is safe","error")})}function save(isValid){function successCallback(res){$state.go("tasks.view",{taskId:res._id},{reload:!0})}function errorCallback(res){vm.error=res.data.message}return isValid?void(vm.task._id?vm.task.$update(successCallback,errorCallback):vm.task.$save(successCallback,errorCallback)):($scope.$broadcast("show-errors-check-validity","vm.form.taskForm"),!1)}$scope.minDate=new Date,$scope.format="dd/MM/yyyy",$scope.altInputFormats=["d!/M!/yyyy"],$scope.dateOptions={formatYear:"yy",startingDay:1};var vm=this;vm.authentication=Authentication,vm.task=task,vm.created=moment(vm.task.created,"YYYY MM DD, h:mm:ss a").fromNow(),vm.today=moment().format("MMMM Do YYYY, h:mm:ss a"),vm.error=null,vm.form={},vm.remove=remove,vm.save=save,vm.locationCollapsed=!1,$scope.isReadonly=!0,$scope.cancel=function(){$scope.$dismiss()},$scope.data={model:null},$scope.taskCategories=[{cat:"Cleaning",model:"vm.task.cleaning",value:!0},{cat:"Moving & Delivery",model:"vm.task.moving"},{cat:"DIY",model:"vm.task.DIY"},{cat:"Marketing & Design",model:"vm.task.marketing"},{cat:"Online & IT",model:"vm.task.online"},{cat:"Events & Photography",model:"vm.task.photoEvents"},{cat:"Business & Admin",model:"vm.task.office"},{cat:"Fun & Quirky",model:"vm.task.funQuirky"},{cat:"Misc & Other",model:"vm.task.misc"}],$scope.toastPosition={bottom:!1,top:!0,left:!1,right:!0},$scope.getToastPosition=function(){return Object.keys($scope.toastPosition).filter(function(pos){return $scope.toastPosition[pos]}).join(" ")},vm.newCo=function(){function successCallback(res){vm.commentAlert(),$state.transitionTo($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})}function errorCallback(res){vm.error=res.data.message}vm.commentAlert=function(){var data={contactName:vm.authentication.user.displayName,emailFrom:"contact@taskmatch.ie",emailTo:vm.task.email,taskName:vm.task.title,taskId:vm.task._id,taskOwner:vm.task.user.displayName,commentOwner:vm.authentication.user.displayName,comment:vm.task.newComment,contactMessage:"Hi, "+vm.task.user.displayName+"! \n "+vm.authentication.user.displayName+' has left the following comment: " '+vm.task.newComment+'" on your task "'+vm.task.title+'" Login to Taskmatch.ie to view your task. \n -- Thanks! from the Taskmatch.ie team'};$http.post("/api/tasks/"+task._id+"/comment-alert",data).success(function(data,status,headers,config){$mdToast.show($mdToast.simple().content("Thanks, "+data.contactName+"! You successfully posted a comment").position($scope.getToastPosition()).hideDelay(5e3))})},$http.post("/api/tasks/"+task._id,{comment:{comment:vm.task.newComment,user:vm.authentication.user,profileImageURL:vm.authentication.user.profileImageURL,displayName:vm.authentication.user.displayName}}).then(successCallback,errorCallback)},vm.newOffer=function(){function successCallback(res){swal("Success!","You successfully posted an offer!","success"),vm.offerAlert(),$scope.$dismiss(),$state.transitionTo($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})}function errorCallback(res){vm.error=res.data.message}vm.offerAlert=function(){var data={contactName:vm.authentication.user.displayName,emailFrom:"contact@taskmatch.ie",emailTo:vm.task.email,taskOwner:vm.task.user.displayName,offerOwner:vm.authentication.user.displayName,offerDesc:vm.offer.offerDesc,taskName:vm.task.title,taskId:vm.task._id,offerId:vm.offer._id};$http.post("/api/tasks/"+task._id+"/offer-alert",data).success(function(data,status,headers,config){$mdToast.show($mdToast.simple().content("Thanks for your offer "+data.contactName).position($scope.getToastPosition()).hideDelay(5e3))})},$http.post("/api/offers",{taskId:vm.task._id,taskName:vm.task.title,taskDesc:vm.task.taskDesc,taskOwnerUser:vm.task.user,taskOwnerDisplayName:vm.task.user.displayName,taskOwnerEmail:vm.task.email,taskOwnerAbout:vm.task.about,taskOwnerAdditionalProvidersData:vm.task.additionalProvidersData,offerUser:vm.authentication.user,offerUserAverage:vm.authentication.user.reviews,offerOwnerEmail:vm.authentication.user.email,offerOwnerTelephone:vm.authentication.user.phoneNumber,offerOwnerPayPal:vm.authentication.user.payPalEmail,taskOwnerUserProfileImageURL:vm.task.profileImageURL,offerDesc:vm.offer.offerDesc,offerPrice:vm.offer.offerPrice,offerDate:vm.offer.offerDate,displayName:vm.authentication.user.displayName,profileImageURL:vm.authentication.user.profileImageURL,about:vm.authentication.user.about,provider:vm.authentication.user.provider,providerData:vm.authentication.providerData,additionalProvidersData:vm.authentication.user.additionalProvidersData}).then(successCallback,errorCallback)},$scope.fbshareCurrentPage=function(){return window.open("https://www.facebook.com/sharer/sharer.php?u="+escape(window.location.href)+"&t="+document.title,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600"),!1};var offersOnThisTask=[];$http.get("api/offers").success(function(data,status){for(var allOffers=data,i=0;i<allOffers.length;i++)allOffers[i].taskId===vm.task._id&&offersOnThisTask.push(allOffers[i]),vm.task.offers=offersOnThisTask;for(var total=0,i=0;i<offersOnThisTask.length;i++)if(offersOnThisTask[i].offerUserAverage){for(var numberOfRatingsForOfferUser=offersOnThisTask[i].offerUserAverage.length,e=0;e<offersOnThisTask[i].offerUserAverage.length;e++)total+=+offersOnThisTask[i].offerUserAverage[e].rating;var userAverageRating=total/numberOfRatingsForOfferUser;vm.userAverageRating=userAverageRating}}),vm.removeComment=function(){swal({title:"Are you sure?",text:"You will not be able to recover this comment!",type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, delete it!",cancelButtonText:"No, cancel please!",closeOnConfirm:!1,closeOnCancel:!1},function(isConfirm){if(isConfirm){var removed=vm.task.comments.splice(this.$index,1),data={comment:removed,commentID:removed[0]._id,taskId:vm.task._id};$http.post("/api/tasks/"+vm.task._id+"/delete-comment",data).success(function(data,status,headers,config){}),swal("Deleted!","The comment has been been deleted.","success")}else swal("Cancelled","The comment is safe","error")})},vm.cancel=function(){vm.$dismiss()},vm.steps=["one","two","three"],vm.step=0,vm.isFirstStep=function(){return 0===vm.step},vm.isLastStep=function(){return vm.step===vm.steps.length-1},vm.isCurrentStep=function(step){return vm.step===vm},vm.setCurrentStep=function(step){vm.step=step},vm.getCurrentStep=function(){return vm.steps[vm.step]},vm.getNextLabel=function(){return vm.isLastStep()?"Submit":"Siguiente"},vm.handlePrevious=function(){vm.step-=vm.isFirstStep()?0:1},vm.cancel=function(){vm.$dismiss()},vm.handleNext=function(){vm.isLastStep()?(vm.save(vm.form.taskForm.$valid),$scope.$dismiss()):vm.step+=1},"facebook"===vm.task.provider}angular.module("tasks").controller("TasksController",TasksController).filter("customFilter",function(){return function(items,search){return search?items.filter(function(element){return Object.getOwnPropertyNames(element).find(function(x){return x===search.substring(0,search.indexOf(":"))})}):items}}),TasksController.$inject=["$scope","$state","Authentication","taskResolve","$http","$modal","$mdToast","$animate"]}(),function(){function TasksService($resource){return $resource("api/tasks/:taskId",{taskId:"@_id"},{update:{method:"PUT"}})}angular.module("tasks").factory("TasksService",TasksService),TasksService.$inject=["$resource"]}(),angular.module("users.admin").run(["Menus",function(Menus){Menus.addSubMenuItem("topbar","admin",{title:"Manejar usuarios",state:"admin.users"})}]),angular.module("users.admin.routes").config(["$stateProvider",function($stateProvider){$stateProvider.state("admin.users",{url:"/users",templateUrl:"modules/users/client/views/admin/list-users.client.view.html",controller:"UserListController"}).state("admin.user",{url:"/users/:userId",templateUrl:"modules/users/client/views/admin/view-user.client.view.html",controller:"UserController",resolve:{userResolve:["$stateParams","Admin",function($stateParams,Admin){return Admin.get({userId:$stateParams.userId})}]}}).state("admin.user-edit",{url:"/users/:userId/edit",templateUrl:"modules/users/client/views/admin/edit-user.client.view.html",controller:"UserController",resolve:{userResolve:["$stateParams","Admin",function($stateParams,Admin){return Admin.get({userId:$stateParams.userId})}]}})}]),angular.module("users").config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push(["$q","$location","Authentication",function($q,$location,Authentication){return{responseError:function(rejection){switch(rejection.status){case 401:Authentication.user=null,$location.path("signin");break;case 403:}return $q.reject(rejection)}}}])}]),angular.module("users").config(["$stateProvider",function($stateProvider){$stateProvider.state("settings",{"abstract":!0,url:"/settings",templateUrl:"modules/users/client/views/settings/settings.client.view.html",data:{roles:["user","admin"]}}).state("profile",{url:"/:userId",templateUrl:"modules/users/client/views/public-profile/profile.client.view.html"}).state("myTasks",{url:"/:userId/my-tasks",templateUrl:"modules/users/client/views/public-profile/user-tasks.client.view.html",controller:"userTasksController",controllerAs:"vm",params:{myFilter:{statusOpen:!0}}}).state("settings.dashboard",{url:"/dashboard",templateUrl:"modules/users/client/views/settings/dashboard.client.view.html"}).state("settings.tasks",{url:"/my-tasks",templateUrl:"modules/users/client/views/public-profile/user-tasks.client.view.html",controller:"userTasksController",controllerAs:"vm",params:{myFilter:{statusOpen:!0}}}).state("settings.reviews",{url:"/my-reviews",templateUrl:"modules/users/client/views/settings/reviews.client.view.html",controller:"UserReviewsCtrl"}).state("settings.messages",{url:"/messages",templateUrl:"modules/users/client/views/settings/messages.client.view.html",controller:"messagesController"}).state("settings.notifications",{url:"/notifications",templateUrl:"modules/users/client/views/settings/notifications.client.view.html",controller:"notificationsController"}).state("settings.alerts",{url:"/alerts",templateUrl:"modules/users/client/views/settings/alerts.client.view.html",controller:"alertsController",controllerAs:"vm"}).state("settings.profile",{url:"/profile",templateUrl:"modules/users/client/views/settings/edit-profile.client.view.html"}).state("settings.payments",{url:"/payments",templateUrl:"modules/users/client/views/settings/edit-payment-details.client.view.html"}).state("settings.password",{url:"/password",templateUrl:"modules/users/client/views/settings/change-password.client.view.html"}).state("settings.accounts",{url:"/accounts",templateUrl:"modules/users/client/views/settings/manage-social-accounts.client.view.html"}).state("settings.picture",{url:"/picture",templateUrl:"modules/users/client/views/settings/change-profile-picture.client.view.html"}).state("authentication",{"abstract":!0,url:"/authentication",templateUrl:"modules/users/client/views/authentication/authentication.client.view.html"}).state("authentication.signup",{url:"/signup",templateUrl:"modules/users/client/views/authentication/signup.client.view.html"}).state("authentication.signin",{url:"/signin?err",templateUrl:"modules/users/client/views/authentication/signin.client.view.html"}).state("password",{"abstract":!0,url:"/password",template:"<ui-view/>"}).state("password.forgot",{url:"/forgot",templateUrl:"modules/users/client/views/password/forgot-password.client.view.html"}).state("password.reset",{"abstract":!0,url:"/reset",template:"<ui-view/>"}).state("password.reset.invalid",{url:"/invalid",templateUrl:"modules/users/client/views/password/reset-password-invalid.client.view.html"}).state("password.reset.success",{url:"/success",templateUrl:"modules/users/client/views/password/reset-password-success.client.view.html"}).state("password.reset.form",{url:"/:token",templateUrl:"modules/users/client/views/password/reset-password.client.view.html"})}]),angular.module("users.admin").controller("UserListController",["$scope","$filter","Admin",function($scope,$filter,Admin){$scope.labelsPieChart=["Download Sales","In-Store Sales","Mail-Order Sales"],$scope.pieData=[300,500,100],$scope.labels=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre"],$scope.series=["Series A","Series B"],$scope.data=[[65,59,80,81,56,55,40,70,68],[28,48,40,19,86,27,90,95,92]],function(w,d,s,g,js,fs){g=w.gapi||(w.gapi={}),g.analytics={q:[],ready:function(f){this.q.push(f)}},js=d.createElement(s),fs=d.getElementsByTagName(s)[0],js.src="https://apis.google.com/js/platform.js",fs.parentNode.insertBefore(js,fs),js.onload=function(){g.load("analytics")}}(window,document,"script"),gapi.analytics.ready(function(){gapi.analytics.auth.authorize({container:"embed-api-auth-container",clientid:"1052279473598-phulcego9iht7kr7l7lp4es8gkflb63v.apps.googleusercontent.com"});var viewSelector=new gapi.analytics.ViewSelector({container:"view-selector-container"});viewSelector.execute();var mainChartRowClickListener,mainChart=new gapi.analytics.googleCharts.DataChart({query:{dimensions:"ga:browser",metrics:"ga:sessions",sort:"-ga:sessions","max-results":"6"},chart:{type:"TABLE",container:"main-chart-container",options:{width:"100%"}}}),breakdownChart=new gapi.analytics.googleCharts.DataChart({query:{dimensions:"ga:date",metrics:"ga:sessions","start-date":"7daysAgo","end-date":"yesterday"},chart:{type:"LINE",container:"breakdown-chart-container",options:{width:"100%"}}});viewSelector.on("change",function(ids){var options={query:{ids:ids}};mainChartRowClickListener&&google.visualization.events.removeListener(mainChartRowClickListener),mainChart.set(options).execute(),breakdownChart.set(options),breakdownChart.get().query.filters&&breakdownChart.execute()}),mainChart.on("success",function(response){var chart=response.chart,dataTable=response.dataTable;mainChartRowClickListener=google.visualization.events.addListener(chart,"select",function(event){if(chart.getSelection().length){var row=chart.getSelection()[0].row,browser=dataTable.getValue(row,0),options={query:{filters:"ga:browser=="+browser},chart:{options:{title:browser}}};breakdownChart.set(options).execute()}})})}),Admin.query(function(data){$scope.users=data,$scope.buildPager()}),$scope.buildPager=function(){$scope.pagedItems=[],$scope.itemsPerPage=15,$scope.currentPage=1,$scope.figureOutItemsToDisplay()},$scope.figureOutItemsToDisplay=function(){$scope.filteredItems=$filter("filter")($scope.users,{$:$scope.search}),$scope.filterLength=$scope.filteredItems.length;var begin=($scope.currentPage-1)*$scope.itemsPerPage,end=begin+$scope.itemsPerPage;$scope.pagedItems=$scope.filteredItems.slice(begin,end)},$scope.pageChanged=function(){$scope.figureOutItemsToDisplay()}}]),angular.module("users.admin").controller("UserController",["$scope","$state","Authentication","userResolve",function($scope,$state,Authentication,userResolve){$scope.authentication=Authentication,$scope.user=userResolve,$scope.remove=function(user){confirm("Are you sure you want to delete this user?")&&(user?(user.$remove(),$scope.users.splice($scope.users.indexOf(user),1)):$scope.user.$remove(function(){$state.go("admin.users")}))},$scope.update=function(isValid){if(!isValid)return $scope.$broadcast("show-errors-check-validity","userForm"),!1;var user=$scope.user;user.$update(function(){$state.go("admin.user",{userId:user._id})},function(errorResponse){$scope.error=errorResponse.data.message})}}]),angular.module("users").controller("AuthenticationController",["$scope","$state","$http","$location","$window","Authentication","PasswordValidator",function($scope,$state,$http,$location,$window,Authentication,PasswordValidator){$scope.authentication=Authentication,$scope.popoverMsg=PasswordValidator.getPopoverMsg(),$scope.error=$location.search().err,$scope.cancel=function(){$scope.$dismiss()},$scope.welcomeEmail=function(){var data={subject:"Hi, "+$scope.authentication.user.displayName+"! Welcome to Taskmatch.ie",contactName:$scope.authentication.user.displayName,emailFrom:"contact@taskmatch.ie",emailTo:$scope.authentication.user.email,subject:"Welcome to Taskmatch.ie!"};$http.post("/api/auth/welcome-email",data).success(function(data,status,headers,config){console.log("sent")})},$scope.signup=function(isValid){return $scope.error=null,isValid?void $http.post("/api/auth/signup",$scope.credentials).success(function(response){$scope.authentication.user=response,$scope.welcomeEmail(),$state.go($state.previous.state.name||"home",$state.previous.params)}).error(function(response){$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","userForm"),!1)},$scope.signin=function(isValid){return $scope.error=null,isValid?void $http.post("/api/auth/signin",$scope.credentials).success(function(response){$scope.authentication.user=response,$state.go($state.previous.state.name||"settings.dashboard",$state.previous.params),$scope.cancel()}).error(function(response){$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","userForm"),!1)},$scope.callOauthProvider=function(url){$state.previous&&$state.previous.href&&(url+="?redirect_to="+encodeURIComponent($state.previous.href)),$window.location.href=url}}]),angular.module("users").controller("PasswordController",["$scope","$stateParams","$http","$location","Authentication","PasswordValidator",function($scope,$stateParams,$http,$location,Authentication,PasswordValidator){$scope.authentication=Authentication,$scope.popoverMsg=PasswordValidator.getPopoverMsg(),$scope.authentication.user&&$location.path("/"),$scope.askForPasswordReset=function(isValid){return $scope.success=$scope.error=null,isValid?void $http.post("/api/auth/forgot",$scope.credentials).success(function(response){$scope.credentials=null,$scope.success=response.message}).error(function(response){$scope.credentials=null,$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","forgotPasswordForm"),!1)},$scope.resetUserPassword=function(isValid){return $scope.success=$scope.error=null,isValid?void $http.post("/api/auth/reset/"+$stateParams.token,$scope.passwordDetails).success(function(response){$scope.passwordDetails=null,Authentication.user=response,$location.path("/password/reset/success")}).error(function(response){$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","resetPasswordForm"),!1)}}]),angular.module("users").controller("publicProfileSettings",["$scope","$http","$location","Users","Authentication","$modal","$rootScope","$filter",function($scope,$http,$location,Users,Authentication,$modal,$rootScope,$filter){var user=$location.path(),userid=user.split("/");$filter("orderBy");$scope.predicate="created",$scope.reverse=!0,$scope.order=function(predicate){$scope.reverse=$scope.predicate===predicate?!$scope.reverse:!1,$scope.predicate=predicate},window.fbAsyncInit=function(){FB.init({appId:"564444857062476",xfbml:!0,version:"v2.7"}),FB.getLoginStatus(function(response){"connected"===response.status?(console.log("Logged in."),FB.api("/"+$rootScope.profileUser.additionalProvidersData.facebook.id,{fields:"context.fields(mutual_friends)"},function(response){if(response&&!response.error){var friendsofFriends=response,mutualFriendsNames=response.context.mutual_friends.data,friendsofFriendsLength=friendsofFriends.context.mutual_friends.data.length;$scope.friendsofFriendsLength=friendsofFriendsLength;for(var profileMutualFriendsArray=[],i=0;i<mutualFriendsNames.length;i++)profileMutualFriendsArray.push(mutualFriendsNames[i].name);$scope.profileMutualFriendsArray=profileMutualFriendsArray,console.log(profileMutualFriendsArray)}})):console.log("not logged in with facebook")})},function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),
js.id=id,js.src="//connect.facebook.net/en_US/sdk.js",fjs.parentNode.insertBefore(js,fjs))}(document,"script","facebook-jssdk"),$http.get("api/users"+user).then(function(response){$scope.user=response.data,$rootScope.profileUser=response.data;var userReviews=(response.data.displayName,response.data.email,response.data.reviews),numberOfReviews=userReviews.length;if(!response.data.reviews)var numberOfReviews=0;$scope.numberOfReviews=numberOfReviews;for(var total=0,one=0,two=0,three=0,four=0,five=0,i=0;i<userReviews.length;i++)1===userReviews[i].rating?one+=1:2===userReviews[i].rating?two+=1:3===userReviews[i].rating?three+=1:4===userReviews[i].rating?four+=1:5===userReviews[i].rating&&(five+=1),total+=+userReviews[i].rating;$scope.oneStars=one,$scope.twoStars=two,$scope.threeStars=three,$scope.fourStars=four,$scope.fiveStars=five;var userAverage=total/numberOfReviews;$scope.userAverage=userAverage;var positiveRating=userAverage/5*100;$scope.positiveRating=positiveRating}),$scope.five=5,$scope.four=4,$scope.three=3,$scope.two=2,$scope.one=1;$scope.max=5,$scope.isReadonly=!0,$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)},$http.get("api/tasks").then(function(response){for(var respTasks=response.data,taskTitles=[],postedTasksTotal=0,completedTasksTotal=0,i=0;i<respTasks.length;i++)respTasks[i].user._id==userid[1]&&(console.log(respTasks[i].title+" task posted by "+respTasks[i].user._id),postedTasksTotal+=1,taskTitles.push(respTasks[i].title),respTasks[i].statusClosed===!0&&(completedTasksTotal+=1)),$scope.completedTasksTotal=completedTasksTotal,$scope.postedTasksTotal=postedTasksTotal,console.log(completedTasksTotal);var authenticatedUser=Authentication.user;$scope.authenticatedUser=authenticatedUser,$scope.taskTitles=taskTitles,$scope.requestAQuote=function(){$modal.open({templateUrl:"modules/users/client/views/public-profile/request-quote.client.view.html",controller:"requestAQuoteController",resolve:{profileUser:$rootScope.profileUser}})},$scope.uploadCoverPhoto=function(){$modal.open({templateUrl:"modules/users/client/views/settings/change-cover-picture.client.view.html",controller:"ChangeProfileCoverPictureController",resolve:{profileUser:$rootScope.profileUser}})}})}]),angular.module("users").controller("requestAQuoteController",["$scope","$http","$location","Users","Authentication","$modal","profileUser","$mdToast",function($scope,$http,$location,Users,Authentication,$modal,profileUser,$mdToast){var user=Authentication.user;$http.get("api/tasks").then(function(response){for(var respTasks=response.data,taskTitles=[],postedTasksTotal=0,i=0;i<respTasks.length;i++)respTasks[i].user._id===user._id&&(postedTasksTotal+=1,taskTitles.push({title:respTasks[i].title,id:respTasks[i]._id}));$scope.postedTasksTotal=postedTasksTotal,$scope.taskTitles=taskTitles}),$scope.toastPosition={bottom:!1,top:!0,left:!1,right:!0},$scope.getToastPosition=function(){return Object.keys($scope.toastPosition).filter(function(pos){return $scope.toastPosition[pos]}).join(" ")},$scope.requestAQuoteAlert=function(){var data={contactName:profileUser.displayName,emailFrom:"contact@taskmatch.ie",emailTo:profileUser.email,taskName:$scope.selectedTask.title,taskId:$scope.selectedTask.id,taskOwner:user.displayName};$http.post("/api/users/"+user._id+"/request-quote-alert",data).success(function(data,status,headers,config){swal("Success!","You successfully requested a quote!","success"),$mdToast.show($mdToast.simple().content("Thanks, "+user.displayName+"! You successfully requested a quote from "+profileUser.displayName).position($scope.getToastPosition()).hideDelay(5e3))})}}]),angular.module("users").controller("alertsController",["$scope","$http","Authentication",function($scope,$http,Authentication){var vm=this,userId=Authentication.user._id;vm.user=Authentication.user,$http.get("api/users/"+userId).then(function(response){for(var tags=[],alerts=response.data.alerts,i=0;i<alerts.length;i++)tags.push(alerts[i]);console.log(tags),$scope.tags=tags})}]).filter("filterByTags",function(){return function(items,tags){var filtered=[];return(items||[]).forEach(function(item){var matches=tags.some(function(tag){return item.indexOf(tag.text)>-1});matches&&filtered.push(item)}),filtered}}),angular.module("users").controller("ChangePasswordController",["$scope","$http","Authentication","PasswordValidator",function($scope,$http,Authentication,PasswordValidator){$scope.user=Authentication.user,$scope.popoverMsg=PasswordValidator.getPopoverMsg(),$scope.changeUserPassword=function(isValid){return $scope.success=$scope.error=null,isValid?void $http.post("/api/users/password",$scope.passwordDetails).success(function(response){$scope.$broadcast("show-errors-reset","passwordForm"),$scope.success=!0,$scope.passwordDetails=null}).error(function(response){$scope.error=response.message}):($scope.$broadcast("show-errors-check-validity","passwordForm"),!1)}}]),angular.module("users").controller("ChangeProfileCoverPictureController",["$scope","$timeout","$window","Authentication","$state","FileUploader",function($scope,$timeout,$window,Authentication,$state,FileUploader){$scope.user=Authentication.user,$scope.imageURL=$scope.user.coverImageURL,$scope.cancel=function(){$scope.$dismiss()},$scope.uploader=new FileUploader({url:"api/users/cover-picture",alias:"newProfilePicture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}},$scope.uploader.onSuccessItem=function(fileItem,response,status,headers){$scope.success=!0,$scope.user=Authentication.user=response,$scope.cancelUpload(),$scope.cancel(),$state.transitionTo($state.current,$state.params,{reload:!0,inherit:!1,notify:!0})},$scope.uploader.onErrorItem=function(fileItem,response,status,headers){$scope.cancelUpload(),$scope.error=response.message},$scope.uploadProfilePicture=function(){$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.imageURL=$scope.user.profileImageURL}}]),angular.module("users").controller("ChangeProfilePictureController",["$scope","$timeout","$window","Authentication","FileUploader",function($scope,$timeout,$window,Authentication,FileUploader){$scope.user=Authentication.user,$scope.imageURL=$scope.user.profileImageURL,$scope.uploader=new FileUploader({url:"api/users/picture",alias:"newProfilePicture"}),$scope.uploader.filters.push({name:"imageFilter",fn:function(item,options){var type="|"+item.type.slice(item.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(type)}}),$scope.uploader.onAfterAddingFile=function(fileItem){if($window.FileReader){var fileReader=new FileReader;fileReader.readAsDataURL(fileItem._file),fileReader.onload=function(fileReaderEvent){$timeout(function(){$scope.imageURL=fileReaderEvent.target.result},0)}}},$scope.uploader.onSuccessItem=function(fileItem,response,status,headers){$scope.success=!0,$scope.user=Authentication.user=response,$scope.cancelUpload()},$scope.uploader.onErrorItem=function(fileItem,response,status,headers){$scope.cancelUpload(),$scope.error=response.message},$scope.uploadProfilePicture=function(){$scope.success=$scope.error=null,$scope.uploader.uploadAll()},$scope.cancelUpload=function(){$scope.uploader.clearQueue(),$scope.imageURL=$scope.user.profileImageURL}}]),angular.module("users").controller("DashboardController",["$scope","Authentication","$http","$location","Users","$rootScope",function($scope,Authentication,$http,$location,Users,$rootScope){window.fbAsyncInit=function(){FB.init({appId:"564444857062476",xfbml:!0,version:"v2.7"}),FB.getLoginStatus(function(response){"connected"===response.status?(console.log("Hi, you are logged in."),FB.api("/me/friends","GET",{},function(response){$rootScope.mutualFriends=response,console.log(response);for(var mutualFriends=response.data,mutualFriendsArray=[],i=0;i<mutualFriends.length;i++)mutualFriendsArray.push(mutualFriends[i].name);$scope.mutualFriendsArray=mutualFriendsArray})):console.log("not logged in with facebook")})},function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="//connect.facebook.net/en_US/sdk.js",fjs.parentNode.insertBefore(js,fjs))}(document,"script","facebook-jssdk");var userId=Authentication.user._id,notificationsList=[];$http.get("api/tasks").then(function(response){var respTasks=response.data,allTasks=response.data;$scope.allTasks=allTasks;for(var postedTasksTotal=0,completedTasksTotal=0,statusAssignedTotal=0,statusPostedAwaitingPayment=0,statusOpenTotal=0,i=0;i<respTasks.length;i++)respTasks[i].user._id==userId&&(postedTasksTotal+=1,respTasks[i].statusClosed===!0?completedTasksTotal+=1:respTasks[i].statusAssigned===!0?statusAssignedTotal+=1:respTasks[i].statusAssigned===!0&&respTasks[i].statusPaid===!1?statusPostedAwaitingPayment+=1:respTasks[i].statusOpen===!0&&(statusOpenTotal+=1)),$scope.respTasks=respTasks,$scope.completedTasksTotal=completedTasksTotal,$scope.postedTasksTotal=postedTasksTotal,$scope.statusAssignedTotal=statusAssignedTotal,$scope.statusPostedAwaitingPayment=statusPostedAwaitingPayment,$scope.statusOpenTotal=statusOpenTotal});var offersOnMyTasks=[];$http.get("api/offers").then(function(response){for(var respOffers=response.data,postedOffersTotal=0,offerAcceptedTotal=0,completedOffersTotal=0,i=0;i<respOffers.length;i++)respOffers[i].taskOwnerUser===userId&&(offersOnMyTasks.push(respOffers[i]),respOffers[i].offerClosed===!0?completedOffersTotal+=1:respOffers[i].offerAccepted===!0&&(offerAcceptedTotal+=1));$scope.offersOnMyTasks=offersOnMyTasks,$scope.respOffers=respOffers,$scope.postedOffersTotal=postedOffersTotal,$scope.completedOffersTotal=completedOffersTotal,$scope.offerAcceptedTotal=offerAcceptedTotal}),$scope.notificationsList=notificationsList,$scope.myInterval=1e4,$scope.noWrapSlides=!1;$scope.slides=[{url1:"tasks.list({ myFilter : { cleaning: true } })",image:"../modules/core/client/img/category/Cleaning.png",url2:"tasks.list({ myFilter : { moving: true } })",image2:"../modules/core/client/img/category/MovingDelivery.png",url3:"tasks.list({ myFilter : { DIY: true } })",image3:"../modules/core/client/img/category/handyman.png"},{url1:"tasks.list({ myFilter : { marketing: true } })",image:"../modules/core/client/img/category/Marketing.png",url2:"tasks.list({ myFilter : { funQuirky: true } })",image2:"../modules/core/client/img/category/FunQuirky.png",url3:"tasks.list({ myFilter : { photoEvents: true } })",image3:"../modules/core/client/img/category/EventsPhotography.png"},{url1:"tasks.list({ myFilter : { onlineIT: true } })",image:"../modules/core/client/img/category/computerIT.png",url2:"tasks.list({ myFilter : { office: true } })",image2:"../modules/core/client/img/category/Office.png",url3:"tasks.list({ myFilter : { misc: true } })",image3:"../modules/core/client/img/category/Others.png"}];$scope.user=Authentication.user}]),function(){function EditPaymentDetailsController(Authentication,$scope,$mdToast,$document,$animate,$http,$window){$window.Stripe.setPublishableKey("pk_live_nycjXdZVMuyCeshiayQ32Ljb"),$scope.user=Authentication.user,$scope.onSubmit=function(){$scope.processing=!0},$scope.stripeCallback=function(code,result){if($scope.processing=!1,$scope.hideAlerts(),result.error)$scope.stripeError=result.error.message;else{var data=(result.id,{stripeToken:result.id,customerName:$scope.user.displayName,customerEmail:$scope.user.email,userId:user._id,result:result});$scope.createNewCustomer=function(){$http.post("/api/users/"+user._id+"/create-new-customer",data).success(function(stripeToken,data,status,headers,config){swal("Success!","You successfully saved your payment details!","success")}).error(function(data,status,headers,config){console.log(status),swal("Oops...","Something went wrong!","error")})};var updateData={stripeToken:result.id,customerId:$scope.user.stripeCustomerId,customerName:$scope.user.displayName,customerEmail:$scope.user.email,userId:user._id,result:result};$scope.updateCustomer=function(){$http.post("/api/users/"+user._id+"/update-customer",updateData).success(function(stripeToken,data,status,headers,config){swal("Success!","You successfully updated your payment details!","success")}).error(function(data,status,headers,config){console.log(status),swal("Oops...","Something went wrong!","error")})},$scope.createNewCustomer()}},$scope.customerCharges=function(){var data={customerId:$scope.user.stripeCustomerId};$scope.user.stripeCustomerId;$http.post("/api/users/"+$scope.user._id+"/customer-charges",data).success(function(res,data,status,headers,config){$scope.customerCharges=res}).error(function(res,data,status,headers,config){console.log("error")})},$scope.customerCharges(),$scope.customerDetails=function(){var customerDetailsData={customerId:$scope.user.stripeCustomerId};$scope.user.stripeCustomerId;$http.post("/api/users/"+$scope.user._id+"/customer-details",customerDetailsData).success(function(res,data,status,headers,config){$scope.customerDetails=res}).error(function(res,data,status,headers,config){console.log("error")})},$scope.customerDetails(),$scope.updateReceivePayment=function(){var receivePaymentsData={payPalEmail:user.payPalEmail};$http.post("/api/users/"+user._id+"/receive-payments",receivePaymentsData).success(function(stripeToken,data,status,headers,config){swal("Success!","You successfully updated your PayPal details!","success")}).error(function(data,status,headers,config){console.log(status),swal("Oops...","Something went wrong!","error")})},$scope.hideAlerts=function(){$scope.stripeError=null,$scope.stripeToken=null}}Stripe.setPublishableKey("pk_live_nycjXdZVMuyCeshiayQ32Ljb"),angular.module("users").controller("EditPaymentDetailsController",EditPaymentDetailsController),EditPaymentDetailsController.$inject=["Authentication","$scope","$mdToast","$document","$animate","$http","$window"]}(),angular.module("users").controller("EditProfileController",["$scope","$http","$location","Users","Authentication","$state",function($scope,$http,$location,Users,Authentication,$state){$scope.user=Authentication.user,$scope.updateUserProfile=function(isValid){if($scope.success=$scope.error=null,!isValid)return $scope.$broadcast("show-errors-check-validity","userForm"),!1;$scope.showHints=!0;var user=new Users($scope.user);user.$update(function(response){$scope.$broadcast("show-errors-reset","userForm"),swal("Success!","You successfully updated your profile!","success"),$state.transitionTo($state.current,$state.params,{reload:!0,inherit:!1,notify:!0}),$scope.success=!0,Authentication.user=response},function(response){$scope.error=response.data.message})}}]),angular.module("users").controller("SocialAccountsController",["$scope","$http","Authentication",function($scope,$http,Authentication){$scope.user=Authentication.user,$scope.hasConnectedAdditionalSocialAccounts=function(provider){for(var i in $scope.user.additionalProvidersData)return!0;return!1},$scope.isConnectedSocialAccount=function(provider){return $scope.user.provider===provider||$scope.user.additionalProvidersData&&$scope.user.additionalProvidersData[provider]},$scope.removeUserSocialAccount=function(provider){$scope.success=$scope.error=null,$http["delete"]("/api/users/accounts",{params:{provider:provider}}).success(function(response){$scope.success=!0,$scope.user=Authentication.user=response}).error(function(response){$scope.error=response.message})}}]),function(){function messagesController(TasksService,OffersService,$scope,$stateParams,$filter,$http,Authentication,$rootScope){var vm=this,userId=Authentication.user._id;vm.user=Authentication.user,vm.tasks=TasksService.query(),$http.get("api/offers").then(function(response){for(var myOffers=[],offersMessages=response.data,i=0;i<offersMessages.length;i++)offersMessages[i].taskOwnerUser==userId&&myOffers.push(offersMessages[i]);$scope.myOffers=myOffers})}angular.module("users").controller("messagesController",messagesController),messagesController.$inject=["TasksService","OffersService","$scope","$stateParams","$filter","$http","Authentication","$rootScope"]}(),angular.module("users").controller("notificationsController",["$scope","Authentication","$http","$location","Users","$rootScope","$filter",function($scope,Authentication,$http,$location,Users,$rootScope,$filter){var vm=this,userId=Authentication.user._id;$filter("orderBy");$scope.predicate="created",$scope.reverse=!0,$scope.order=function(predicate){$scope.reverse=$scope.predicate===predicate?!$scope.reverse:!1,$scope.predicate=predicate};var myTasks=[];$http.get("api/tasks").then(function(response){for(var respTasks=response.data,postedTasksTotal=0,completedTasksTotal=0,statusAssignedTotal=0,statusOpenTotal=0,i=0;i<respTasks.length;i++)respTasks[i].user._id===userId?(postedTasksTotal+=1,myTasks.push(respTasks[i])):respTasks[i].user._id===userId&&respTasks[i].statusClosed===!0?(console.log("task"+respTasks[i].title+"completed"),completedTasksTotal+=1):respTasks[i].user._id===userId&&respTasks[i].statusAssigned===!0?(console.log("task"+respTasks[i].title+"assigned"),statusAssignedTotal+=1):respTasks[i].user._id===userId&&respTasks[i].statusOpen===!0&&(console.log("task"+respTasks[i].title+"Open"),statusOpenTotal+=1);$scope.completedTasksTotal=completedTasksTotal,$scope.postedTasksTotal=postedTasksTotal,$scope.statusAssignedTotal=statusAssignedTotal,$scope.statusOpenTotal=statusOpenTotal,vm.statusOpenTotal=statusOpenTotal,$scope.myTasks=myTasks,console.log(myTasks)});var notificationsList=[],offersOnMyTasks=[];$http.get("api/offers").then(function(response){var respOffers=response.data;notificationsList.push(respOffers);for(var postedOffersTotal=0,offerAcceptedTotal=0,completedOffersTotal=0,i=0;i<respOffers.length;i++)respOffers[i].taskOwnerUser===userId&&(offersOnMyTasks.push(respOffers[i]),respOffers[i].offerClosed===!0?completedOffersTotal+=1:respOffers[i].offerAccepted===!0&&(offerAcceptedTotal+=1));$scope.offersOnMyTasks=offersOnMyTasks,$scope.respOffers=respOffers,$scope.postedOffersTotal=postedOffersTotal,$scope.completedOffersTotal=completedOffersTotal,$scope.offerAcceptedTotal=offerAcceptedTotal}),$scope.notificationsList=notificationsList,$scope.user=Authentication.user}]),angular.module("users").controller("SettingsController",["$scope","Authentication","$timeout","$mdSidenav",function($scope,Authentication,$timeout,$mdSidenav){function buildToggler(componentId){return function(){$mdSidenav(componentId).toggle()}}$scope.user=Authentication.user,$scope.toggleLeft=buildToggler("left"),$scope.toggleRight=buildToggler("right")}]),angular.module("users").controller("UserReviewsCtrl",["$scope","$http","Authentication",function($scope,$http,Authentication){var user=Authentication.user._id;$scope.isReadonly=!0,$scope.hoveringOver=function(value){$scope.overStar=value,$scope.percent=100*(value/$scope.max)};$scope.five=5,$scope.four=4,$scope.three=3,$scope.two=2,$scope.one=1,$http.get("api/users/"+user).then(function(response){$scope.user=response.data;var userReviews=(response.data.displayName,response.data.email,response.data.reviews),numberOfReviews=userReviews.length;$scope.numberOfReviews=numberOfReviews;for(var total=0,one=0,two=0,three=0,four=0,five=0,i=0;i<userReviews.length;i++)1===userReviews[i].rating?one+=1:2===userReviews[i].rating?two+=1:3===userReviews[i].rating?three+=1:4===userReviews[i].rating?four+=1:5===userReviews[i].rating&&(five+=1),total+=+userReviews[i].rating;$scope.oneStars=one,$scope.twoStars=two,$scope.threeStars=three,$scope.fourStars=four,$scope.fiveStars=five;var userAverage=total/numberOfReviews;$scope.userAverage=userAverage;var positiveRating=userAverage/5*100;$scope.positiveRating=positiveRating})}]),function(){function userTasksController(TasksService,OffersService,$scope,$stateParams,$filter,$http,Authentication){var vm=this,userId=Authentication.user._id;vm.user=Authentication.user,$scope.taskCategories=[{cat:"All",filter:""},{cat:"Cleaning",filter:"cleaning: true"},{cat:"Moving & Delivery",filter:"moving: true"},{cat:"DIY",filter:"DIY: true"},{cat:"Marketing & Design",filter:"marketing: true"},{cat:"Digital & IT",filter:"onlineIT: true"},{cat:"Events & Photography",filter:"photoEvents: true"},{cat:"Business & Admin",filter:"office: true"},{cat:"Fun & Quirky",filter:"funQuirky: true"},{cat:"Misc & Other ",filter:"misc: true"}],$scope.myFilter=$stateParams.myFilter;$filter("orderBy");$scope.predicate="created",$scope.reverse=!0,$scope.order=function(predicate){$scope.reverse=$scope.predicate===predicate?!$scope.reverse:!1,$scope.predicate=predicate},$scope.quantity=10,$http.get("api/tasks").then(function(response){for(var respTasks=response.data,myTasks=[],i=0;i<respTasks.length;i++)respTasks[i].user._id===userId&&myTasks.push(respTasks[i]),$scope.myTasks=myTasks})}angular.module("users").controller("userTasksController",userTasksController).filter("customFilter",function(){return function(items,search){return search?items.filter(function(element){return Object.getOwnPropertyNames(element).find(function(x){return x===search.substring(0,search.indexOf(":"))})}):items}}),userTasksController.$inject=["TasksService","OffersService","$scope","$stateParams","$filter","$http","Authentication"]}(),angular.module("users").directive("passwordValidator",["PasswordValidator",function(PasswordValidator){return{require:"ngModel",link:function(scope,element,attrs,ngModel){ngModel.$validators.requirements=function(password){var status=!0;if(password){var result=PasswordValidator.getResult(password),requirementsIdx=0,requirementsMeter=[{color:"danger",progress:"20"},{color:"warning",progress:"40"},{color:"info",progress:"60"},{color:"primary",progress:"80"},{color:"success",progress:"100"}];result.errors.length<requirementsMeter.length&&(requirementsIdx=requirementsMeter.length-result.errors.length-1),scope.requirementsColor=requirementsMeter[requirementsIdx].color,scope.requirementsProgress=requirementsMeter[requirementsIdx].progress,result.errors.length?(scope.popoverMsg=PasswordValidator.getPopoverMsg(),scope.passwordErrors=result.errors,status=!1):(scope.popoverMsg="",scope.passwordErrors=[],status=!0)}return status}}}}]),angular.module("users").directive("passwordVerify",[function(){return{require:"ngModel",scope:{passwordVerify:"="},link:function(scope,element,attrs,ngModel){scope.$watch(function(){var combined;return(scope.passwordVerify||ngModel)&&(combined=scope.passwordVerify+"_"+ngModel),combined},function(value){value&&(ngModel.$validators.passwordVerify=function(password){var origin=scope.passwordVerify;return origin!==password?!1:!0})})}}}]),angular.module("users").directive("lowercase",function(){return{require:"ngModel",link:function(scope,element,attrs,modelCtrl){modelCtrl.$parsers.push(function(input){return input?input.toLowerCase():""}),element.css("text-transform","lowercase")}}}),angular.module("users").factory("Authentication",["$window",function($window){var auth={user:$window.user};return auth}]),angular.module("users").factory("PasswordValidator",["$window",function($window){var owaspPasswordStrengthTest=$window.owaspPasswordStrengthTest;return{getResult:function(password){var result=owaspPasswordStrengthTest.test(password);return result},getPopoverMsg:function(){var popoverMsg="Please enter a passphrase or password with greater than 10 characters, numbers, lowercase, upppercase, and special characters.";return popoverMsg}}}]),angular.module("users").factory("Users",["$resource",function($resource){return $resource("api/users",{},{update:{method:"PUT"}})}]),angular.module("users.admin").factory("Admin",["$resource",function($resource){return $resource("api/users/:userId",{userId:"@_id"},{update:{method:"PUT"}})}]);